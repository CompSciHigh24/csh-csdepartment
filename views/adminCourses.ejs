<!DOCTYPE html>
<html>

<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width">
		<title>CSH Course Admin Panel</title>
		<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/navbar.css" />
		<link rel="stylesheet" href="/courses.css" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
				integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
		<link href="/courses.css" rel="stylesheet" type="text/css" />
</head>

<body>
		<h1 class="text-center border-2 rounded m-10"> CSH Course Admin Panel </h1>
		<div class="flex justify-center mt-8">
				<button class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded"
						onclick="showCreateCourse()">
						Create new course
				</button>
		</div>

		<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-col-3 lg:grid-cols-4 px-10">
				<%for(let i=0; i<courses.length; i++){%>
				<div class="folder ">
						<div class="container leading-5 border rounded-lg pb-10">
								<p1 class="courseName text-xl pb-10"> Course name: <%= courses[i].courseName%></p1>
								<p2 class="hidden"> <%= courses[i]._id%> </p2>
						</div>
						<div class="folder__back">
								<div class="paper text-center text-2xl "><%= courses[i].courseName%></div>
								<div class="paper text-center text-2xl"> Grade: <%= courses[i].courseGrade%> </div>
								<div class="folder__front"></div>
								<div class="folder__front right">
										<img class="h-40 object-center m-2"
												src="https://static1.squarespace.com/static/5b328976aa49a1b7b46b89c3/t/5b328c90575d1ff0174390ba/1710002027821/" />
								</div>
						</div>
						<div class="editForm hidden ">
								<form id="editCourse">
										<div class="mb-4">
												<label for="editcourseName" class="block font-bold mb-2">
														<p2 class="hidden"><%= courses[i]._id%></p2>
														Course Name
												</label>
												<input type="text" value="<%=courses[i].courseName%>" id="editcourseName"
														class="border rounded-lg px-3 py-2 w-full" required>
										</div>
										<div class="mb-4">
												<label for="editcourseGrade" class="block font-bold mb-2">
														Course Grade
												</label>
												<input type="number" value="<%=courses[i].courseGrade%>" min="9" max="12" id="editcourseGrade"
														class="border rounded-lg px-3 py-2 w-full" required>
										</div>
									
										<div class="mb-4">
												<label for="editcourseDescription" class="block font-bold mb-2">
														Course Description
												</label>
												<textarea type="text" id="editcourseDescription"
														class="border rounded-lg px-3 py-2 w-full" required><%=courses[i].courseDescription%></textarea>
										</div>
										
										<div class="mb-4">
												<label for="editpossibleCareerpath" class="block font-bold mb-2">
														This Course Related to UX?
												</label>
												<select type="number" id="editpossibleCareerpath"  
													class="border rounded-lg px-3 py-2 w-full" required>
												<option value="<%=courses[i].possibleCareerpath%>" selected>
													<%=courses[i].possibleCareerpath%>
												</option>
												<option value="No">
													No
												</option>
												<option value="Yes">
													Yes
												</option>

													</select>
										</div>
										<div class="flex justify-end">
												<button type="button"
														class="bg-green-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded mr-2"
														onclick="hideEditForm(this.closest('.editForm'))">Cancel</button>
												<button type="submit" class="bg-green-500 text-white font-semibold py-2 px-4  rounded">Save</button>
										</div>
								</form>
						</div>
						<button class="edit-btn w-50 bg-blue-500 text-white rounded py-2 mt-4"> Edit </button>
						<button class="delete-btn w-50 bg-red-500 text-white rounded py-2 mt-4"> Delete </button>
				</div>
				<%}%>
		</div>

		<div class="fixed z-10 inset-0 overflow-y-auto hidden " id="createCourse">
				<div class="flex items-center justify-center min-h-screen">
						<div class="bg-white rounded-lg shadow-lg p-6">
								<h2 class="text-2xl font-bold mb-4">Create New Course</h2>
								<form id="createCourseForm">
										<div class="mb-4">
												<label for="courseName" class="block font-bold mb-2">
														Course Name
												</label>
												<input type="text" id="courseName" class="border rounded-lg px-3 py-2 w-full" required>
										</div>
										<div class="mb-4">
												<label for="courseGrade" class="block font-bold mb-2">
														Course Grade
												</label>
												<input type="number" id="courseGrade" value="9" min="9" max="12"
														class="border rounded-lg px-3 py-2 w-full" required>
										</div>
								
										<div class="mb-4">
												<label for="courseDescription" class="block font-bold mb-2">
														Course Description
												</label>
												<textarea type="text" id="courseDescription" class="border rounded-lg px-3 py-2 w-full"
														required></textarea>
										</div>
										<div class="mb-4">
												<label for="possibleCareerpath" class="block font-bold mb-2">
													This Course Related to UX?
												</label>
												<select  placeholder="Yes or No"id="possibleCareerpath"  
													class="border rounded-lg px-3 py-2 w-full" required>
												<option value="No">
													No
												</option>
												<option value="Yes">
													Yes
												</option>
													</select>
										</div>
										<div class="flex justify-end">
												<button type="button"
														class="bg-green-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded mr-2"
														onclick="hideCreateForm()">Cancel</button>
												<button type="submit" class="bg-green-500 text-white font-semibold py-2 px-4  rounded">Create
														Course</button>
										</div>
								</form>
						</div>
				</div>
		</div>

		<script>
				function showCreateCourse() {
						document.getElementById('createCourse').classList.remove('hidden');
				}

				function hideCreateForm() {
						document.getElementById('createCourse').classList.add('hidden');
						document.getElementById('createCourseForm').reset();
				}

				function showEditForm(editForm) {
						editForm.classList.remove('hidden');
				}

				function hideEditForm(editForm) {
					const folder = editForm.closest('.folder');
						folder.querySelector('.container').classList.remove('hidden')
						folder.querySelector('.folder__back').classList.remove('hidden')
					
						editForm.classList.add('hidden')
						editForm.reset();
				}

				document.querySelectorAll(".delete-btn").forEach((button) => {
						button.addEventListener("click", () => {
								const courseContainer = button.closest(".folder");
								const courseName = courseContainer.querySelector("p1").textContent.trim();
								const courseId = courseContainer.querySelector("p2").textContent.trim();
								if (confirm(`Are you sure you want to delete ${courseName}? If you do all PROJECTS in that COURSE will also be DELETED!!!`)) {
										fetch(`/course/${courseId}`, {
												method: "DELETE",
												headers: { "Content-Type": "application/json; charset=UTF-8" },
										})
												.then((response) => response.json())
												.then((json) => {
														console.log(json);
														location.reload();
												})
												.catch((error) => {
														console.error('Error:', error);
												});
								}
						});
				});

				document.getElementById('createCourseForm').addEventListener('submit', (e) => {
						e.preventDefault();	
						console.log("Here is the ID: ",document.getElementById('UX').value)
					

						
					
						const formData = {
								courseName: document.getElementById('courseName').value,
								courseGrade: document.getElementById('courseGrade').value,
								courseDescription: document.getElementById('courseDescription').value,
								possibleCareerpath: document.getElementById('possibleCareerpath').value
						};
						fetch('/course', {
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify(formData)
						})
								.then(response => response.json())
								.then(data => {
										console.log("Course created: ", data);
										hideCreateForm();
										location.reload();
								})
								.catch(error => {
										console.error('Error: ', error);
								});
				});

				document.querySelectorAll('.edit-btn').forEach((button) => {
						button.addEventListener('click', () => {
								const courseContainer = button.closest('.folder');
								const courseId = courseContainer.querySelector('p2').textContent.trim();
								const editForm = courseContainer.querySelector('.editForm');

								 courseContainer.querySelector('.container').classList.add('hidden')
								 courseContainer.querySelector('.folder__back').classList.add('hidden')

							

								showEditForm(editForm);

								editForm.addEventListener('submit', (e) => {
										e.preventDefault();
										const formData = {
												courseName: editForm.querySelector('#editcourseName').value,
												courseGrade: editForm.querySelector('#editcourseGrade').value,
												courseDescription: editForm.querySelector('#editcourseDescription').value,
												possibleCareerpath: editForm.querySelector('#editpossibleCareerpath').value,
										};

										fetch(`/course/${courseId}`, {
												method: 'PATCH',
												headers: {
														'Content-Type': 'application/json',
												},
												body: JSON.stringify(formData),
										})
												.then((response) => response.json())
												.then((data) => {
														console.log('Course updated:', data);
														// hideEditForm(editForm);
														// location.reload();
												})
												.catch((error) => {
														console.error('Error:', error);
												});
								});
						});
				});
		</script>

					<!-- https://htmlformatter.com/  THE replit formatter was not wokring so I used this-->
</body>

</html>
